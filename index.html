<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Daily Task Sync</title>
  <style>
    :root{
      --bg:#0f1724;--card:#121b2d;--accent:#7c5cff;--muted:#9aa6b2;--radius:12px;
      --font:Inter,system-ui;
    }
    *{box-sizing:border-box;margin:0;padding:0} body{
      font-family:var(--font);background:var(--bg);color:#fff;display:flex;
      flex-direction:column;align-items:center;padding:40px 20px;
    }
    h1{font-size:1.8rem;margin-bottom:20px;text-align:center}
    .task-box{
      background:var(--card);padding:20px;border-radius:var(--radius);
      max-width:400px;width:100%;box-shadow:0 8px 20px rgba(0,0,0,.3);
    }
    .task{display:flex;align-items:center;justify-content:space-between;
      padding:12px 0;border-bottom:1px solid rgba(255,255,255,.08);
    }
    .task:last-child{border-bottom:none}
    button{
      padding:6px 12px;border:none;border-radius:var(--radius);
      background:var(--accent);color:#fff;cursor:pointer;transition:.2s;
      font-size:.85rem;
    }
    button[disabled]{opacity:.4;cursor:not-allowed}
    #log{margin-top:20px;font-size:.9rem;color:var(--muted)}
  </style>
</head>
<body>
  <h1>Daily Tasks âœ…</h1>
  <div id="userBadge" style="margin-bottom:10px;font-size:0.9rem;color:#a3b5ff;background:#1c2542;padding:6px 12px;border-radius:8px;display:inline-block;border:1px solid #2e3b69;">Loading user...</div>

  <div class="task-box" id="taskList">
    <!-- Tasks will be injected here via JS -->
  </div>

  <p id="log"></p>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
import { getDatabase, ref, set, onValue } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyDB_MCfhRogp9_uUgMZeBcYBgj7K6NoPNU",
  authDomain: "tt-31219.firebaseapp.com",
  databaseURL: "https://tt-31219-default-rtdb.firebaseio.com",
  projectId: "tt-31219",
  storageBucket: "tt-31219.firebasestorage.app",
  messagingSenderId: "194072423805",
  appId: "1:194072423805:web:f9825d0ec84758ae6ab014"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

// remember user locally (no switching ui)
let currentUser = localStorage.getItem("taskUser") || "user1";
localStorage.setItem("taskUser", currentUser);

const tasks = [
  { id: 1, name: "Khana kha liya?" },
  { id: 2, name: "Kesi ho?", type: "text" },
  { id: 3, name: "Dhyan rakhna" },
  { id: 4, name: "Padhai hogyi?" }
];

const moodOptions = [
  { label: "Badhiya", emoji: "ðŸ˜Ž" },
  { label: "Achhi hu", emoji: "ðŸ˜Š" },
  { label: "Thik hu", emoji: "ðŸ™‚" },
  { label: "Thik thak", emoji: "ðŸ˜" },
  { label: "Mood off", emoji: "ðŸ˜”" }
];

let state = {};
const listEl = document.getElementById("taskList");
const logEl = document.getElementById("log");

function sync(id, val){
  set(ref(db,`tasks/${id}`),{
    value:val,
    time:Date.now(),
    updatedBy: currentUser
  });
}

function glow(btn){
  btn.style.boxShadow = "0 0 15px #7c5cff";
  setTimeout(()=>btn.style.boxShadow="",600);
}

function completeTask(id, btn){
  sync(id,"done");
  glow(btn);
}

function setMood(id,mood,btn){
  sync(id,mood);
  glow(btn);
}

function formatTime(t){
  return new Date(t).toLocaleTimeString();
}

function render(){
  listEl.innerHTML="";
  tasks.forEach(t=>{
    const row=document.createElement("div");
    row.className="task";
    const entry = state[t.id];

    if(t.type==="text"){
      let html=`<span>${t.name}</span><div style='display:flex;gap:6px;flex-wrap:wrap;'>`;
      moodOptions.forEach(o=>{
        const active = entry?.value === `${o.label} ${o.emoji}`;
        html += `<button data-id='${t.id}' data-val='${o.label} ${o.emoji}' style='padding:6px 10px;font-size:.8rem;${active?"outline:2px solid var(--accent);" :""}'>${o.emoji} ${o.label}</button>`;
      });
      html+=`</div>`;
      row.innerHTML = html;
    } else {
      row.innerHTML = `<span>${t.name}</span><button data-id='${t.id}' ${entry?.value?"disabled":''}>${entry?.value?"Done":"Mark"}</button>`;
    }

    if(entry?.time){
      const info=document.createElement("div");
      info.style.fontSize=".7rem";
      info.style.color="var(--muted)";
      info.textContent = `Updated by ${entry.updatedBy} at ${formatTime(entry.time)}`;
      row.appendChild(info);
    }

    listEl.appendChild(row);
  });
}

document.body.addEventListener("click",e=>{
  if(e.target.tagName!="BUTTON") return;
  const id = e.target.getAttribute("data-id");
  const mood = e.target.getAttribute("data-val");
  if(!id) return;
  if(mood) setMood(id,mood,e.target);
  else completeTask(id,e.target);
});

onValue(ref(db,"tasks"),snap=>{
  if(snap.exists()){
    state = snap.val();
  }
  render();
document.getElementById("userBadge").textContent = `You are: ${currentUser} âœ…`;
});

render();
logEl.textContent = `Logged in as: ${currentUser}`;
</script>
</body>
</html>
